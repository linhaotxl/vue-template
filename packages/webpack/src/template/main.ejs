(function () {

  // 模块缓存对象
  var __webpack_module_cache__ = {}

  /**
   * 模拟 require 函数
   * @param {string} moduleId 导入模块 id
   */
  function __webpack_require__ (moduleId) {
    // 有缓存直接读取缓存
    if (__webpack_module_cache__[moduleId]) {
      return __webpack_module_cache__[moduleId].exports
    }

    // 没缓存，首先创建 module 对象
    var module = (__webpack_module_cache__[moduleId] = {
      exports: {}
    })

    // 调用模块代码
    __webpack_modules__[moduleId](module, module.exports, __webpack_require__)

    // 返回模块导出对象
    return module.exports
  }


  <% if (global) { %>
  // global
  ;(function () {
    __webpack_require__.g = (function () {
      if (typeof globalThis === 'object') {
        return globalThis
      }
    })()
  })()
  <% } %>


  <% if (publicPath) { %>
  // public path
  ;(function () {
    var scriptUrl = ''
    var document = __webpack_require__.g.document
    // dom 环境，获取执行当前 js 脚本的的绝对路径
    if (document) {
      scriptUrl = document.currentScript.src
    }
    // 将最后一个 / 后面替换为 /，即去掉文件名，保留目录
    scriptUrl = scriptUrl.replace(/\/[^\/]+$/, '/')
    __webpack_require__.p = scriptUrl
  })()
  <% } %>


  <% if (asyncChunk) { %>
  /**
   * 已经安装好的模块
   * 0 表示已经加载成功
   */
  var installedChunks = {
    main: 0
  }

  /**
   * 异步加载模块
   * @param {string} chunkId chunk 名称
   */
  __webpack_require__.e = function (chunkId) {
    // 调用 j 等待所有 promises 成功执行
    var promises = []
    __webpack_require__.j(chunkId, promises)
    return Promise.all(promises)
  }

  /**
   * 开始加载动态模块
   */
  __webpack_require__.j = function (chunkId, promises) {
    // 每个动态模块创建对应的 Promise 对象，并记录 resolve 和 reject 方法
    const promise = new Promise((resolve, reject) => {
      installedChunks[chunkId] = [resolve, reject]
    })

    // 将 Promise 对象存储
    promises.push(promise)

    // 创建 script 标签并插入文档中
    var url = __webpack_require__.p + chunkId + '.js'
    var script = document.createElement('script')
    script.src = url
    document.head.appendChild(script)
  }

  ;(function () {
    /**
     * 通过 jsonp 引入动态模块时执行的函数
     * @param {string} chunkId chunk 名称
     * @param {object} otherModules 动态模块自身以及依赖的模块
     */
    function webpackJsonpCallback ([chunkId, otherModules]) {
      // 将其他模块存储在主模块中
      for (var id in otherModules) {
        __webpack_modules__[id] = otherModules[id]
      }

      // 执行每个 chunk 在 j 中产生的 resolve 方法，并标记加载成功
      installedChunks[chunkId][0]()
      installedChunks[chunkId] = 0
    }

    __webpack_require__.g['webpackChunk<%- packageName %>'] = {
      push: webpackJsonpCallback
    }
  })()
  <% } %>

  // 所有模块集合
  var __webpack_modules__ = ({
    <%- include('modules.ejs', { modules: [chunk.entryModule] }) %>
    <%- include('modules.ejs', { modules: chunk.dependenceModules }) %>
  })

  // 从入口开始调用
  __webpack_require__("<%- chunk.entryModule.id %>")

})()
